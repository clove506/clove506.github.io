	<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>【合肥项目】运营中心-API | Hexo</title>
  <meta name="author" content="John Doe">
  
  <meta name="description" content="摘要 合肥项目-运营中心API">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="【合肥项目】运营中心-API"/>
  <meta property="og:site_name" content="Hexo"/>

  
  
		<!-- favicon -->
		<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
		<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
		<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
		<link rel="manifest" href="/manifest.json">
		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.png">
		<meta name="theme-color" content="#009688">
		<!-- favicon end -->
    <!-- <link href="/favicon.ico" rel="icon"> -->
  

  <!-- toc -->
  <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css">

  <!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">

  <!-- material design -->
	<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css">
  <!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
	<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  

  

  <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="/libs/jquery-2.0.3.min.js" type="text/javascript"><\/script>')</script>

</head>

 	<body>
	  <nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">菜单</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Hexo</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                    <a href="/" title="">
                    <i class="fa fa-home"></i>首页
                    </a>
                </li>
                
                <li>
                    <a href="/archives" title="">
                    <i class="fa fa-list"></i>存档
                    </a>
                </li>
                
                <li>
                    <a href="/about" title="">
                    <i class="fa fa-info-circle"></i>关于
                    </a>
                </li>
                
                <li>
                    <a href="/atom.xml" title="这是一个订阅源">
                    <i class="fa fa-rss"></i>RSS
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</nav>

	  <div class="container" >
	    <div class="row">
	
	<div class="col-md-9 center-content">
	

		<div class="content">
			<!-- index -->
		   

			  		<h2>【合肥项目】运营中心-API</h2>
					
					<div>
						<span class="post-time">2016-12-28 15:30:00</span>
					</div>	
					

					<div class="article-content">
						<h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p> 合肥项目-运营中心API</p>
<a id="more"></a>
<h1 id="运营中心API详细设计"><a href="#运营中心API详细设计" class="headerlink" title="运营中心API详细设计"></a>运营中心API详细设计</h1><h2 id="登录接口设计"><a href="#登录接口设计" class="headerlink" title="登录接口设计"></a>登录接口设计</h2><p>POST /api/era/v1/admin/swordkeeper/login</p>
<h3 id="接口描述"><a href="#接口描述" class="headerlink" title="接口描述"></a>接口描述</h3><p>运营人员通过预设的手机号和短信验证码进行登录操作</p>
<h3 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"phone"</span>:<span class="string">"1333333333"</span>,</div><div class="line">    <span class="attr">"captcha"</span>:<span class="string">"2309"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"result"</span>:&#123;</div><div class="line">        <span class="attr">"success"</span>:<span class="literal">true</span>,</div><div class="line">        <span class="attr">"code"</span>:<span class="number">0</span></div><div class="line">        &#125;,</div><div class="line">    <span class="attr">"token"</span>:<span class="string">"ljdhalf2134rdfjsuf"</span>,</div><div class="line">    <span class="attr">"adminId"</span> : <span class="number">1</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="实现设计"><a href="#实现设计" class="headerlink" title="实现设计"></a>实现设计</h3><p>复用之前的登录逻辑，在winston项目中新建两张表，分别保存短信验证码-账号对应关系以及预设的账号信息，登录时，通过短信验证码校验，如果验证码正确并且账号为系统预设，就为该账号生成token同时存入账号信息表中（若之前有token则覆盖），之后每次进行请求，前端同学将token存入httpsHeader，以便gateway校验（复用之前前端的逻辑就可以）。<br>失败信息返回时，需要传回displayMsg。</p>
<h2 id="短信验证码接口设计"><a href="#短信验证码接口设计" class="headerlink" title="短信验证码接口设计"></a>短信验证码接口设计</h2><p>POST  /api/era/v1/admin/swordkeeper/sms/{phoneNumber}</p>
<h3 id="接口描述-1"><a href="#接口描述-1" class="headerlink" title="接口描述"></a>接口描述</h3><p>运营人员通过预设的手机号来请求短信验证码</p>
<h3 id="Response-1"><a href="#Response-1" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"result"</span>:&#123;</div><div class="line">        <span class="attr">"success"</span>:<span class="literal">true</span>,</div><div class="line">        <span class="attr">"code"</span>:<span class="number">0</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="实现设计-1"><a href="#实现设计-1" class="headerlink" title="实现设计"></a>实现设计</h3><p>复用之前的登录逻辑，通过smsAPI来发送短信，发送的验证码数字由本地随机方法生成并入库，方便登录时做校验。同时，如果是非预设号码，不发送短信并返回相应的错误信息。</p>
<h2 id="查询订单列表"><a href="#查询订单列表" class="headerlink" title="查询订单列表"></a>查询订单列表</h2><p>GET /api/swordkeeper/v1/orders?draw=20&amp;start=2&amp;length=20&amp;conditions={no=EC_22222&amp;nurseName=lixinghua&amp;patientName=wangsan&amp;state=3}&amp;order[0][column]=2&amp;order[0][dir]=1</p>
<h3 id="接口描述-2"><a href="#接口描述-2" class="headerlink" title="接口描述"></a>接口描述</h3><p>根据组合的复数查询条件来返回对应订单的列表</p>
<h3 id="Request-参数说明"><a href="#Request-参数说明" class="headerlink" title="Request 参数说明"></a>Request 参数说明</h3><ul>
<li>draw为前端请求的防多次点击的校验参数，原样返回即可</li>
<li>start为分页请求相关参数，表示返回列表的第一个元素</li>
<li>length为分页所需订单数量</li>
<li>conditions中相关查询条件为:nurseName(护士姓名)、patientName(患者姓名)、no(订单编号)、orderState(订单状态)。</li>
<li>order[0][column]为排序参照字段，目前约定的字段有：订单时间（1）、订单状态（2）、服务名称（3）</li>
<li>isDesc是是否倒序</li>
</ul>
<h3 id="Response-2"><a href="#Response-2" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">	<span class="attr">"result"</span>:&#123;</div><div class="line">	<span class="attr">"success"</span>:<span class="literal">true</span>,</div><div class="line">	<span class="attr">"code"</span>:<span class="number">0</span>,</div><div class="line">	&#125;,</div><div class="line"></div><div class="line">	<span class="attr">"draw"</span>:<span class="number">20</span>,</div><div class="line">	<span class="attr">"recordsFiltered"</span>:<span class="number">34</span>,</div><div class="line">	<span class="attr">"recordsTotal"</span>:<span class="number">20</span>,</div><div class="line"></div><div class="line">	<span class="attr">"order"</span>:[</div><div class="line">		&#123;</div><div class="line">		<span class="attr">"orderId"</span>:<span class="number">1</span>,</div><div class="line">		<span class="attr">"no"</span>:<span class="string">"3C_9997723BED"</span>,</div><div class="line">		<span class="attr">"itemName"</span>:<span class="string">"上门排尿"</span>,</div><div class="line">		<span class="attr">"orgName"</span>:<span class="string">"合肥一院"</span>,</div><div class="line">		<span class="attr">"createAt"</span>:<span class="string">"2016.12.23"</span>,</div><div class="line">		<span class="attr">"userName"</span>:<span class="string">"申帅"</span>,</div><div class="line">		<span class="attr">"nurseName"</span>:<span class="string">"赵林"</span>,</div><div class="line">		<span class="attr">"state"</span>:<span class="string">"服务中"</span>,</div><div class="line">		<span class="attr">"dealState"</span>:<span class="string">"已处理"</span></div><div class="line">		&#125;</div><div class="line">	]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="实现设计-2"><a href="#实现设计-2" class="headerlink" title="实现设计"></a>实现设计</h3><p>复数筛选条件的列表查询，其实可以细化为两种查询：一种是通过订单编号准确定位到一个订单（订单编号唯一）；另一种则比较复杂，由于护士和患者的姓名存在重名可能，并且不是小概率事件，所以需要先根据护士和患者的姓名拿到对应姓名下的护士id list 和 患者id list， 根据这两个集合的叉乘检索到所有的数据，将他们组合为一个list，再根据查询条件排序返回。</p>
<h2 id="订单详情"><a href="#订单详情" class="headerlink" title="订单详情"></a>订单详情</h2><p>GET /api/swordkeeper/v1/orders/{orderId}/detail?orderId={orderId}</p>
<h3 id="接口描述-3"><a href="#接口描述-3" class="headerlink" title="接口描述"></a>接口描述</h3><p>根据传入的orderId来查询对应订单的详情</p>
<h3 id="Response-3"><a href="#Response-3" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"result"</span>: &#123;</div><div class="line">        <span class="attr">"success"</span>: <span class="literal">true</span>,</div><div class="line">        <span class="attr">"code"</span>: <span class="number">0</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"odrerInfo"</span>: &#123;</div><div class="line">        <span class="attr">"basicInfo"</span>: &#123;</div><div class="line">            <span class="attr">"orderId"</span>: <span class="number">1</span>,</div><div class="line">            <span class="attr">"no"</span>: <span class="string">"CE_22223334"</span>,</div><div class="line">            <span class="attr">"originPrice"</span>: <span class="number">18000</span>,</div><div class="line">            <span class="attr">"price"</span>: <span class="number">15000</span>,</div><div class="line">            <span class="attr">"amount"</span>: <span class="number">16000</span>,</div><div class="line">            <span class="attr">"itemName"</span>: <span class="string">"上门排尿"</span>,</div><div class="line">            <span class="attr">"createAt"</span>: <span class="string">"2016.11.21"</span>,</div><div class="line">            <span class="attr">"serviceAt"</span>: <span class="string">"2016.11.23"</span>,</div><div class="line">            <span class="attr">"address"</span>: <span class="string">"北京市海淀区大河庄苑南门门口"</span>,</div><div class="line">            <span class="attr">"orderState"</span>: <span class="number">4</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">"userInfo"</span>: &#123;</div><div class="line">            <span class="attr">"id"</span>: <span class="number">23</span>,</div><div class="line">            <span class="attr">"nickName"</span>: <span class="string">"申帅"</span>,</div><div class="line">            <span class="attr">"gender"</span>: <span class="number">1</span>,</div><div class="line">            <span class="attr">"age"</span>: <span class="number">29</span>,</div><div class="line">            <span class="attr">"phone"</span>: <span class="number">13333333333</span>,</div><div class="line">            <span class="attr">"address"</span>: <span class="string">"北京市海淀区大河庄苑地下车库5号车位"</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">"nurseInfo"</span>: &#123;</div><div class="line">            <span class="attr">"id"</span>: <span class="number">34</span>,</div><div class="line">            <span class="attr">"name"</span>: <span class="string">"赵林"</span>,</div><div class="line">            <span class="attr">"org"</span>: <span class="string">"YHJ-有害菌第一医院"</span>,</div><div class="line">            <span class="attr">"job"</span>: <span class="string">"特殊服务人员"</span>,</div><div class="line">            <span class="attr">"phone"</span>: <span class="string">"14444444444"</span>,</div><div class="line">            <span class="attr">"score"</span>: <span class="number">82</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">"itemInfo"</span>: &#123;</div><div class="line">            <span class="attr">"id"</span>: <span class="number">45</span>,</div><div class="line">            <span class="attr">"itemName"</span>: <span class="string">"上门排尿"</span>,</div><div class="line">            <span class="attr">"serviceDuring"</span>: <span class="number">7200</span>,</div><div class="line">            <span class="attr">"desc"</span>: <span class="string">"上·门·排·尿 , 大·吉·大·利"</span></div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"dealOrder"</span>: &#123;</div><div class="line">        <span class="attr">"dealState"</span>: <span class="string">"已处理"</span>,</div><div class="line">        <span class="attr">"availableButton"</span>: <span class="string">"置为退款成功"</span>,</div><div class="line">        <span class="attr">"refundMax"</span>:<span class="number">13000</span>,</div><div class="line">        <span class="attr">"refundCreator"</span>:<span class="string">"nurse"</span>,</div><div class="line">        <span class="attr">"nurse"</span>:[</div><div class="line">		      &#123;</div><div class="line">		      <span class="attr">"nurseId"</span>:<span class="number">1</span>,</div><div class="line">		      <span class="attr">"gender"</span>:<span class="number">1</span>,</div><div class="line">		      <span class="attr">"orgName"</span>:<span class="string">"合肥一院"</span>,</div><div class="line">		      <span class="attr">"job"</span>:<span class="string">"搞基护士"</span>,</div><div class="line">		      <span class="attr">"nurseName"</span>:<span class="string">"赵林"</span>,</div><div class="line">		      <span class="attr">"phoneNumber"</span>:<span class="string">"13333333333"</span>,</div><div class="line">		      <span class="attr">"score"</span>:<span class="number">82</span></div><div class="line">		      &#125;</div><div class="line">	]</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">"logInfo"</span>: &#123;</div><div class="line">        <span class="attr">"logs"</span>: [</div><div class="line">            &#123;</div><div class="line">                <span class="attr">"time"</span>: <span class="string">"2016.12.24 08:40:21"</span>,</div><div class="line">                <span class="attr">"role"</span>: <span class="string">"运营人员"</span>,</div><div class="line">                <span class="attr">"level"</span>: <span class="string">"终极无敌超级金牌运营"</span>,</div><div class="line">                <span class="attr">"account"</span>: <span class="string">"mmliu"</span>,</div><div class="line">                <span class="attr">"action"</span>: <span class="string">"拒绝额外服务"</span>,</div><div class="line">                <span class="attr">"extraInfo"</span>: &#123;</div><div class="line">                    <span class="attr">"comment"</span>: <span class="string">"汝乃天骄，何不上九霄？"</span></div><div class="line">                &#125;,</div><div class="line">                <span class="attr">"displayMsg"</span>: &#123;</div><div class="line">                  <span class="attr">"运营人员mmliu拒绝额外服务，原因：“拒绝py”"</span></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        ],</div><div class="line">        <span class="attr">"finishInfo"</span>: &#123;</div><div class="line">          <span class="attr">"action"</span>: &#123;</div><div class="line">                <span class="attr">"articleSection"</span>: [</div><div class="line">                    &#123;</div><div class="line">                        <span class="attr">"title"</span>: <span class="string">"推荐健康宣教知识"</span>,</div><div class="line">                        <span class="attr">"desc"</span>: <span class="string">"下单后，系统自动向患者推送健康宣教文章"</span>,</div><div class="line">                        <span class="attr">"order"</span>: <span class="number">1</span>,</div><div class="line">                        <span class="attr">"articleSection"</span>: [</div><div class="line">                        &#123;</div><div class="line">                            <span class="attr">"title"</span>: <span class="string">"推荐健康宣教知识"</span>,</div><div class="line">                            <span class="attr">"desc"</span>: <span class="string">"下单后，系统自动向患者推送健康宣教文章"</span>,</div><div class="line">                            <span class="attr">"order"</span>: <span class="number">1</span>,</div><div class="line">                            <span class="attr">"articleContents"</span>: [</div><div class="line">                              &#123;</div><div class="line">                                  <span class="attr">"id"</span>: <span class="number">519</span>,</div><div class="line">                                  <span class="attr">"title"</span>: <span class="string">"后端的第一条宣教"</span>,</div><div class="line">                                  <span class="attr">"progress"</span>: &#123;</div><div class="line">                                      <span class="attr">"msg"</span>: <span class="string">"已读"</span>,</div><div class="line">                                      <span class="attr">"color"</span>: <span class="string">"green"</span></div><div class="line">                                  &#125;</div><div class="line">                              &#125;,</div><div class="line">                              &#123;</div><div class="line">                                  <span class="attr">"id"</span>: <span class="number">1295</span>,</div><div class="line">                                  <span class="attr">"title"</span>: <span class="string">"后端的第二条宣教"</span>,</div><div class="line">                                  <span class="attr">"progress"</span>: &#123;</div><div class="line">                                      <span class="attr">"msg"</span>: <span class="string">"未读"</span>,</div><div class="line">                                      <span class="attr">"color"</span>: <span class="string">"red"</span></div><div class="line">                                  &#125;</div><div class="line">                              &#125;</div><div class="line">                            ]</div><div class="line">                  &#125;</div><div class="line">              ],</div><div class="line">                <span class="attr">"toolSection"</span>: [</div><div class="line">                    &#123;</div><div class="line">                        <span class="attr">"title"</span>: <span class="string">"服务器评估"</span>,</div><div class="line">                        <span class="attr">"desc"</span>: <span class="string">"服务前，对患者状态进行综合评估"</span>,</div><div class="line">                        <span class="attr">"order"</span>: <span class="number">3</span>,</div><div class="line">                        <span class="attr">"toolContents"</span>: [</div><div class="line">                            &#123;</div><div class="line">                                <span class="attr">"id"</span>: <span class="number">124</span>,</div><div class="line">                                <span class="attr">"title"</span>: <span class="string">"后端的第一条自测"</span>,</div><div class="line">                                <span class="attr">"summary"</span>: <span class="string">"自测正文"</span>,</div><div class="line">                                <span class="attr">"progress"</span>: &#123;</div><div class="line">                                    <span class="attr">"msg"</span>: <span class="string">"已自测"</span>,</div><div class="line">                                    <span class="attr">"color"</span>: <span class="string">"green"</span></div><div class="line">                                &#125;</div><div class="line">                            &#125;,</div><div class="line">                            &#123;</div><div class="line">                                <span class="attr">"id"</span>: <span class="number">124</span>,</div><div class="line">                                <span class="attr">"title"</span>: <span class="string">"后端的第二条自测（和第一条一样，不是BUG）"</span>,</div><div class="line">                                <span class="attr">"summary"</span>: <span class="string">""</span>,</div><div class="line">                                <span class="attr">"progress"</span>: &#123;</div><div class="line">                                    <span class="attr">"msg"</span>: <span class="string">"未自测"</span>,</div><div class="line">                                    <span class="attr">"color"</span>: <span class="string">"red"</span></div><div class="line">                                &#125;</div><div class="line">                            &#125;</div><div class="line">                        ]</div><div class="line">                    &#125;</div><div class="line">                ],</div><div class="line">                <span class="attr">"evaluateSection"</span>: [</div><div class="line">                    &#123;</div><div class="line">                        <span class="attr">"title"</span>: <span class="string">"服务器评估"</span>,</div><div class="line">                        <span class="attr">"desc"</span>: <span class="string">"服务前，对患者状态进行综合评估"</span>,</div><div class="line">                        <span class="attr">"order"</span>: <span class="number">2</span>,</div><div class="line">                        <span class="attr">"evaluateContents"</span>: [</div><div class="line">                            &#123;</div><div class="line">                                <span class="attr">"id"</span>: <span class="number">124</span>,</div><div class="line">                                <span class="attr">"title"</span>: <span class="string">"后端的第一条评测"</span>,</div><div class="line">                                <span class="attr">"summary"</span>: <span class="string">"评测正文"</span>,</div><div class="line">                                <span class="attr">"progress"</span>: &#123;</div><div class="line">                                    <span class="attr">"msg"</span>: <span class="string">"已评测"</span>,</div><div class="line">                                    <span class="attr">"color"</span>: <span class="string">"green"</span></div><div class="line">                                &#125;</div><div class="line">                            &#125;,</div><div class="line">                            &#123;</div><div class="line">                                <span class="attr">"id"</span>: <span class="number">124</span>,</div><div class="line">                                <span class="attr">"title"</span>: <span class="string">"后端的第二条评测（和第一条一样，不是BUG）"</span>,</div><div class="line">                                <span class="attr">"summary"</span>: <span class="string">""</span>,</div><div class="line">                                <span class="attr">"progress"</span>: &#123;</div><div class="line">                                    <span class="attr">"msg"</span>: <span class="string">"未评测"</span>,</div><div class="line">                                    <span class="attr">"color"</span>: <span class="string">"red"</span></div><div class="line">                                &#125;</div><div class="line">                            &#125;</div><div class="line">                        ]</div><div class="line">                    &#125;</div><div class="line">                ],</div><div class="line">                <span class="attr">"stepSection"</span>: [</div><div class="line">                    &#123;</div><div class="line">                        <span class="attr">"title"</span>: <span class="string">"尿管护理预备操作"</span>,</div><div class="line">                        <span class="attr">"desc"</span>: <span class="string">"服务前，对患者状态进行综合评估"</span>,</div><div class="line">                        <span class="attr">"order"</span>: <span class="number">4</span>,</div><div class="line">                        <span class="attr">"progress"</span>: &#123;</div><div class="line">                            <span class="attr">"msg"</span>: <span class="string">"已完成"</span>,</div><div class="line">                            <span class="attr">"color"</span>: <span class="string">"red"</span></div><div class="line">                        &#125;</div><div class="line">                    &#125;,</div><div class="line">                    &#123;</div><div class="line">                        <span class="attr">"title"</span>: <span class="string">"尿管护理操作"</span>,</div><div class="line">                        <span class="attr">"desc"</span>: <span class="string">"服务前，对患者状态进行综合评估"</span>,</div><div class="line">                        <span class="attr">"order"</span>: <span class="number">5</span>,</div><div class="line">                        <span class="attr">"progress"</span>: &#123;</div><div class="line">                            <span class="attr">"msg"</span>: <span class="string">"未完成"</span>,</div><div class="line">                            <span class="attr">"color"</span>: <span class="string">"red"</span></div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                ]</div><div class="line">            &#125;</div><div class="line">          ]</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="已解决的问题"><a href="#已解决的问题" class="headerlink" title="已解决的问题"></a>已解决的问题</h3><ul>
<li>服务时间保存在什么地方:order–&gt;address–&gt;servingTime</li>
<li>派单部分的检索护士是否需要winston提供接口:需要，已经添加接口</li>
<li>日志的字段信息确认：参照develop下相关对象</li>
<li>服务步骤完成情况在哪里取得：需要的时候找@林慧芝</li>
</ul>
<h3 id="实现设计-3"><a href="#实现设计-3" class="headerlink" title="实现设计"></a>实现设计</h3><p>根据orderId使用CAOrder注解标注service中的方法取得COrder对象，同时根据json需求自己拼装protobuf对象来传递数据；同时，根据订单状态来判断是否出现已处理/未处理按钮以及三个置为XXX的按钮；根据logs来判断可以显示已处理/未处理的订单当前到底是已处理还是未处理。</p>
<h2 id="推送接口设计"><a href="#推送接口设计" class="headerlink" title="推送接口设计"></a>推送接口设计</h2><p>POST /api/swordkeeper/v1/orders/push</p>
<h3 id="接口描述-4"><a href="#接口描述-4" class="headerlink" title="接口描述"></a>接口描述</h3><p>运营人员对高优先级派单的订单进行人工推送</p>
<h3 id="Request-1"><a href="#Request-1" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"nurseIds"</span>:[<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>],</div><div class="line">    <span class="attr">"orderIds"</span>:[<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Response-4"><a href="#Response-4" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"result"</span>:&#123;</div><div class="line">        <span class="attr">"success"</span>:<span class="literal">true</span>,</div><div class="line">        <span class="attr">"code"</span>:<span class="number">0</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h3><p>当前业务场景下是将一个订单推送给多个护士，考虑到日后业务场景扩展，可能出现一个护士推送给多个订单、甚至是多个护士多个订单推送的情况，故此接口设计为传入护士id list 以及 订单 id list，方便日后扩展。</p>
<h3 id="实现设计-4"><a href="#实现设计-4" class="headerlink" title="实现设计"></a>实现设计</h3><p>拿到护士id和订单id后，调用owl下相关方法进行派单即可，同时应在该订单的log中生成一条派单日志。</p>
<h2 id="处理服务超时状态接口设计"><a href="#处理服务超时状态接口设计" class="headerlink" title="处理服务超时状态接口设计"></a>处理服务超时状态接口设计</h2><p>POST /api/swordkeeper/v1/orders/{orderId}/deal-timeout?orderId={orderId}</p>
<h3 id="接口描述-5"><a href="#接口描述-5" class="headerlink" title="接口描述"></a>接口描述</h3><p>运营人员对订单处于超时状态的按钮的订单进行手动处理操作并加入日志</p>
<h3 id="Request-2"><a href="#Request-2" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"desc"</span>:<span class="string">"描述"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Response-5"><a href="#Response-5" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"result"</span>:&#123;</div><div class="line">        <span class="attr">"success"</span>:<span class="literal">true</span>,</div><div class="line">        <span class="attr">"code"</span>:<span class="number">0</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="实现设计-5"><a href="#实现设计-5" class="headerlink" title="实现设计"></a>实现设计</h3><p>对当前订单加入一条操作日志来标识该超时的订单已经得到了客服人员的处理。</p>
<h2 id="添加操作日志接口设计"><a href="#添加操作日志接口设计" class="headerlink" title="添加操作日志接口设计"></a>添加操作日志接口设计</h2><p>POST /api/swordkeeper/v1/orders/{orderId}/log?orderId={orderId}</p>
<h3 id="接口描述-6"><a href="#接口描述-6" class="headerlink" title="接口描述"></a>接口描述</h3><p>运营人员对订单添加一条操作日志(action为comment的log)</p>
<h3 id="Request-3"><a href="#Request-3" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"desc"</span>:<span class="string">"描述"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Response-6"><a href="#Response-6" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"result"</span>:&#123;</div><div class="line">        <span class="attr">"success"</span>:<span class="literal">true</span>,</div><div class="line">        <span class="attr">"code"</span>:<span class="number">0</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="实现设计-6"><a href="#实现设计-6" class="headerlink" title="实现设计"></a>实现设计</h3><p>根据订单id向调用方法（待shawn实现）向订单的logList添加一条日志。</p>
<h2 id="退款接口设计"><a href="#退款接口设计" class="headerlink" title="退款接口设计"></a>退款接口设计</h2><p>POST /api/swordkeeper/v1/orders/{orderId}/refund?orderId={orderId}</p>
<h3 id="接口描述-7"><a href="#接口描述-7" class="headerlink" title="接口描述"></a>接口描述</h3><p>运营人员对申请退款的订单进行处理</p>
<h3 id="Request-4"><a href="#Request-4" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"desc"</span>:<span class="string">"客户无理取闹"</span>,</div><div class="line">    <span class="attr">"status"</span>:<span class="number">0</span>,</div><div class="line">    <span class="attr">"price"</span>:<span class="number">1200</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Response-7"><a href="#Response-7" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"result"</span>:&#123;</div><div class="line">        <span class="attr">"success"</span>:<span class="literal">true</span>,</div><div class="line">        <span class="attr">"code"</span>:<span class="number">0</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="参数说明-1"><a href="#参数说明-1" class="headerlink" title="参数说明"></a>参数说明</h3><ul>
<li>status:0为拒绝，1为同意</li>
<li>price为退款金额</li>
</ul>
<h3 id="实现设计-7"><a href="#实现设计-7" class="headerlink" title="实现设计"></a>实现设计</h3><p>拿到订单id和退款状态后，根据不同的状态抉择调用不同的owl中的接口进行操作，同时在该订单的log中生成一条退款操作日志。</p>
<h2 id="处理异常接口设计"><a href="#处理异常接口设计" class="headerlink" title="处理异常接口设计"></a>处理异常接口设计</h2><p>POST /api/swordkeeper/v1/orders/{orderId}/handle-exception?orderId={orderId}</p>
<h3 id="接口描述-8"><a href="#接口描述-8" class="headerlink" title="接口描述"></a>接口描述</h3><p>运营人员对异常订单状态下的订单进行人为操作</p>
<h3 id="Request-5"><a href="#Request-5" class="headerlink" title="Request"></a>Request</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"desc"</span>:<span class="string">"描述"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Response-8"><a href="#Response-8" class="headerlink" title="Response"></a>Response</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    <span class="attr">"result"</span>:&#123;</div><div class="line">        <span class="attr">"success"</span>:<span class="literal">true</span>,</div><div class="line">        <span class="attr">"code"</span>:<span class="number">0</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="实现设计-8"><a href="#实现设计-8" class="headerlink" title="实现设计"></a>实现设计</h3><p>拿到订单id后，根据订单所处在的不同的状态进行调用owl中不同的订单状态变更的方法，同时生成一条运营人员人为操作订单状态的操作日志（待学文实现）。</p>
<h2 id="状态数字对应关系"><a href="#状态数字对应关系" class="headerlink" title="状态数字对应关系"></a>状态数字对应关系</h2><table>
<thead>
<tr>
<th>状态</th>
<th>数字</th>
</tr>
</thead>
<tbody>
<tr>
<td>待支付</td>
<td>0</td>
</tr>
<tr>
<td>支付状态待确认</td>
<td>1</td>
</tr>
<tr>
<td>待接单</td>
<td>2</td>
</tr>
<tr>
<td>高优先待结单</td>
<td>3</td>
</tr>
<tr>
<td>派单待确认</td>
<td>4</td>
</tr>
<tr>
<td>待服务</td>
<td>5</td>
</tr>
<tr>
<td>服务中</td>
<td>6</td>
</tr>
<tr>
<td>服务超时</td>
<td>7</td>
</tr>
<tr>
<td>服务异常</td>
<td>8</td>
</tr>
<tr>
<td>未评价</td>
<td>9</td>
</tr>
<tr>
<td>退款申请中</td>
<td>10</td>
</tr>
<tr>
<td>待退款</td>
<td>11</td>
</tr>
<tr>
<td>退款中</td>
<td>12</td>
</tr>
<tr>
<td>退款成功</td>
<td>13</td>
</tr>
<tr>
<td>退款失败</td>
<td>14</td>
</tr>
<tr>
<td>发起退款失败</td>
<td>15</td>
</tr>
<tr>
<td>结算中</td>
<td>16</td>
</tr>
<tr>
<td>订单结束</td>
<td>17</td>
</tr>
<tr>
<td>订单关闭</td>
<td>18</td>
</tr>
<tr>
<td>服务纠纷</td>
<td>19</td>
</tr>
<tr>
<td>结束后纠纷</td>
<td>20  </td>
</tr>
</tbody>
</table>
<h2 id="待处理问题"><a href="#待处理问题" class="headerlink" title="待处理问题"></a>待处理问题</h2><ul>
<li>winston更名（我觉着还不错，打倒三体从我做起；推翻三体暴政，世界属于人类)(SwordHolder &amp; Damocles By:zhaolin)</li>
<li>owl中订单列表查询接口默认排序是什么</li>
<li>Yolar中通过nickName查询用户以及通过name查询nurse的查询接口限制最多返回1000条结果</li>
<li>操作日志中账户字段应为唯一标识</li>
</ul>
<h2 id="详细排期"><a href="#详细排期" class="headerlink" title="详细排期"></a>详细排期</h2><table>
<thead>
<tr>
<th>内容</th>
<th>详情</th>
<th>人日</th>
<th>完成情况</th>
<th>负责人</th>
</tr>
</thead>
<tbody>
<tr>
<td>设计文档</td>
<td>完成详细设计文档</td>
<td>1</td>
<td>OK</td>
<td>李圣阳</td>
</tr>
<tr>
<td>订单列表和订单详情接口</td>
<td>完成两个接口的业务逻辑</td>
<td>2</td>
<td>OK</td>
<td>李圣阳</td>
</tr>
<tr>
<td>登录</td>
<td>完成完整登录的逻辑操作以及相关的接口实现</td>
<td>2</td>
<td>X</td>
<td>李江明</td>
</tr>
<tr>
<td>推送</td>
<td>完成推送接口的实现和相关逻辑的实现</td>
<td>1</td>
<td>X</td>
<td>赵蔺</td>
</tr>
<tr>
<td>处理服务超时与添加操作日志</td>
<td>完成处理服务超时接口以及添加操作日志接口和相关逻辑的实现</td>
<td>1</td>
<td>X</td>
<td>赵蔺</td>
</tr>
<tr>
<td>退款</td>
<td>完成退款操作的相关接口和逻辑的实现</td>
<td>1</td>
<td>X</td>
<td>赵蔺</td>
</tr>
<tr>
<td>变更订单状态</td>
<td>完成变更订单状态接口和相关逻辑的实现</td>
<td>1</td>
<td>X</td>
<td>赵蔺      </td>
</tr>
</tbody>
</table>
<h1 id="Time"><a href="#Time" class="headerlink" title="Time"></a>Time</h1><h2 id="2016-12-30-Day-2"><a href="#2016-12-30-Day-2" class="headerlink" title="2016.12.30 Day 2"></a>2016.12.30 Day 2</h2><h3 id="完成"><a href="#完成" class="headerlink" title="完成"></a>完成</h3><ul>
<li>订单列表接口完成</li>
<li>订单详情接口完成</li>
</ul>
<h3 id="进度"><a href="#进度" class="headerlink" title="进度"></a>进度</h3><p> 正常</p>
<h2 id="2016-12-29-winston-创建-Kickoff-1st-day"><a href="#2016-12-29-winston-创建-Kickoff-1st-day" class="headerlink" title="2016.12.29 winston 创建 (Kickoff 1st day)"></a>2016.12.29 winston 创建 (Kickoff 1st day)</h2><h3 id="完成-1"><a href="#完成-1" class="headerlink" title="完成"></a>完成</h3><ul>
<li>winston 项目搭建</li>
<li>详细设计文档上线</li>
</ul>
<h3 id="进度-1"><a href="#进度-1" class="headerlink" title="进度"></a>进度</h3><p> 正常</p>

					</div>

			  <!-- about -->
			  
		</div>

		<!-- pagination -->
	  

		<div class="comment-section">
  
  


</div>
	</div>

	

</div>


		<footer>
			

<p>
  由 <a href="https://hexo.io">hexo</a> 强力驱动 | 搭载 <a href="https://github.com/wayou/hexo-theme-material">material</a> 主题
</p>
<p>
  &copy; 2017 <a href="http://yoursite.com"> John Doe </a>
</p>
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	  </div>

		<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		<script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>

		<!-- material design -->
		<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script>
		<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>
		<!-- toc -->
		<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
		<script src="/libs/tocify/jquery.tocify.custom.js"></script>

		<script src="/js/main.js"></script>

	</body>
</html>
