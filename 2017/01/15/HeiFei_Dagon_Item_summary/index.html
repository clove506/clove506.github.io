	<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>【合肥项目—Dagon—Item】项目总结。 | Hexo</title>
  <meta name="author" content="John Doe">
  
  <meta name="description" content="摘要合肥项目—Dagon—Item 项目总结。">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="【合肥项目—Dagon—Item】项目总结。"/>
  <meta property="og:site_name" content="Hexo"/>

  
  
		<!-- favicon -->
		<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
		<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
		<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
		<link rel="manifest" href="/manifest.json">
		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.png">
		<meta name="theme-color" content="#009688">
		<!-- favicon end -->
    <!-- <link href="/favicon.ico" rel="icon"> -->
  

  <!-- toc -->
  <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css">

  <!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">

  <!-- material design -->
	<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css">
  <!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
	<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  

  

  <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="/libs/jquery-2.0.3.min.js" type="text/javascript"><\/script>')</script>

</head>

 	<body>
	  <nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">菜单</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Hexo</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                    <a href="/" title="">
                    <i class="fa fa-home"></i>首页
                    </a>
                </li>
                
                <li>
                    <a href="/archives" title="">
                    <i class="fa fa-list"></i>存档
                    </a>
                </li>
                
                <li>
                    <a href="/about" title="">
                    <i class="fa fa-info-circle"></i>关于
                    </a>
                </li>
                
                <li>
                    <a href="/atom.xml" title="这是一个订阅源">
                    <i class="fa fa-rss"></i>RSS
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</nav>

	  <div class="container" >
	    <div class="row">
	
	<div class="col-md-9 center-content">
	

		<div class="content">
			<!-- index -->
		   

			  		<h2>【合肥项目—Dagon—Item】项目总结。</h2>
					
					<div>
						<span class="post-time">2017-01-15 16:16:16</span>
					</div>	
					

					<div class="article-content">
						<h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>合肥项目—Dagon—Item 项目总结。</p>
<a id="more"></a>
<h2 id="WIKI维护人"><a href="#WIKI维护人" class="headerlink" title="WIKI维护人"></a>WIKI维护人</h2><p>clove</p>
<h2 id="说在前面"><a href="#说在前面" class="headerlink" title="说在前面"></a>说在前面</h2><p> 对于一个菜鸟来说，首次独自开发一个子系统，用于商业用途，虚归虚，但值得庆幸的是终究还是做完了，其中滋味，恐怕也就只有自己最清楚。好啦，不想煽情，回归正题。</p>
<h2 id="项目回顾"><a href="#项目回顾" class="headerlink" title="项目回顾"></a>项目回顾</h2><h3 id="整体节奏"><a href="#整体节奏" class="headerlink" title="整体节奏"></a>整体节奏</h3><p>整个项目的时间原计划如下：</p>
<h2 id="时间排期"><a href="#时间排期" class="headerlink" title="时间排期"></a>时间排期</h2><table>
<thead>
<tr>
<th>内容</th>
<th>详情</th>
<th>人日</th>
</tr>
</thead>
<tbody>
<tr>
<td>项目准备</td>
<td>1. github repo <br> 2. config-repo 配置</td>
<td>1 </td>
</tr>
<tr>
<td>Dagon 接口定义</td>
<td>1. Item 接口</td>
<td>1</td>
</tr>
<tr>
<td></td>
<td>2. Service Item 接口</td>
<td>1</td>
</tr>
<tr>
<td></td>
<td>3. Item Prop 接口</td>
<td>1</td>
</tr>
<tr>
<td></td>
<td>4. Service Item Template 接口</td>
<td>1</td>
</tr>
<tr>
<td>Dagon 实现</td>
<td>1. Item CRUD 实现</td>
<td>1</td>
</tr>
<tr>
<td></td>
<td>2. Service Item CRUD 实现</td>
<td>1</td>
</tr>
<tr>
<td></td>
<td>3. Item Prop CRUD 实现</td>
<td>1</td>
</tr>
<tr>
<td></td>
<td>4. Service Item Template CRUD 实现</td>
<td>5</td>
</tr>
</tbody>
</table>
<p>实际的测试结束待上线时间12月22号晚（开发环境）。</p>
<p>整个项目的需求，详细设计文档详见wiki：</p>
<p><a href="http://wiki.office.test.youhujia.com/2017/01/06/HeFei-Item-Design/" target="_blank" rel="external">商品服务API</a></p>
<h2 id="问题总结"><a href="#问题总结" class="headerlink" title="问题总结"></a>问题总结</h2><h3 id="技术方案设计和Review不到位"><a href="#技术方案设计和Review不到位" class="headerlink" title="技术方案设计和Review不到位"></a>技术方案设计和Review不到位</h3><p>开发前期整体的API接口设计不合理，特别是ServiceItem接口设计思路出现问题，有两个直接影响：</p>
<ol>
<li>在开发进度接近50%时，接口和项目结构大改，原有的开发被推翻了，导致项目重新洗牌，从零开始。</li>
<li>在开发后期，处理ServiceItem接口过程中，根据属性值叉乘生成ServiceItem，相当吃力。</li>
</ol>
<p>问题的关键是，二期开发Item，这会是个必趟的坑，我总结有以下原因：</p>
<ol>
<li><p>Item的数据模型不合理<br> 如果只是单纯按照属性值来叉乘生成Service，那应该在属性值表中加入ItemId字段，防止生成ServiceItem的时候还需要去查询数据库得到ItemId，当遇到再添加新的属性和属性值得时候，就可以根据ItemId查询己胆小，还是自己没有主见，都说明了我还不具备独立解决问题的能力，在很大程度上依靠别人，无法形成自得到已有的属性值，相比没有ItemId的情况下，有ItemId更直接。</p>
</li>
<li><p>自己能力不够，信心不足<br> 如果能在开发Item属性值的初期，提出Item模型的缺陷，也许就没有后面那么多麻烦事了。这里，先自我反思，不管是自己胆小，还是自己没有主见，都说明了我还不具备独立解决问题的能力，在很大程度上依靠别人，无法形成自己的一套思维逻辑。期待2017能有所突破~</p>
<p> PS：后端开发团队相当和谐，所谓将熊熊一窝，晨哥的干练严谨作风，将会是影响我以后职业生涯的重要因素。作为实习生，心有余而力不足，有些时候还给晨哥添乱，有点愧疚，不免感慨，遇上他是我的福气~</p>
</li>
</ol>
<h2 id="技术分享"><a href="#技术分享" class="headerlink" title="技术分享"></a>技术分享</h2><p> 虽说是第一次单独开发一个子系统，但其中还是有很多值得分享和总结的地方。</p>
<h3 id="亮点-属性值叉乘生成新的ServiceItem记录"><a href="#亮点-属性值叉乘生成新的ServiceItem记录" class="headerlink" title="亮点 属性值叉乘生成新的ServiceItem记录"></a>亮点 属性值叉乘生成新的ServiceItem记录</h3><p>当增加属性和属性值时，分为两种情况：</p>
<ol>
<li>新增属性，同时新增属性值。在这种情况下，又可以分为两种情况，第一次新增属性和属性值，非第一次新增属性和属性值。第一次新增属性和属性值相对来说比较简单，新增数据合法之后即可插入数据库。当非第一次新增属性和属性值时，需要将之前所有的属性值取出来并叉乘此次新增的属性值，生成新的ServiceItem记录。而这次最关键的操作是如何获取已有不同属性值的组合。我的解决思路如下：    </li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">private ServiceItemContext buildServiceItemName2SaveContext(Item item, ItemPropValue itemPropValue) &#123;</div><div class="line"></div><div class="line">    ServiceItemContext serviceItemContext = new ServiceItemContext();</div><div class="line"></div><div class="line">    List&lt;Long&gt; itemPropIdsWithOutAddItemProp = itemPropDAO.findByItemId(item.getId()).stream()</div><div class="line">        .filter(itemProp -&gt; itemProp.getId().longValue() != itemPropValue.getItemPropId().longValue())</div><div class="line">        .map(itemProp -&gt; itemProp.getId()).collect(Collectors.toList());</div><div class="line"></div><div class="line">    Map&lt;Long, List&lt;ItemPropValue&gt;&gt; itemPropValueIdItemPropValueWithOutAddItemProp = itemPropIdsWithOutAddItemProp.stream()</div><div class="line">        .flatMap(itemPropId -&gt; itemPropValueDAO.findByItemPropId(itemPropId).stream())</div><div class="line">        .collect(Collectors.groupingBy(ItemPropValue::getItemPropId));</div><div class="line">    Map&lt;Long, List&lt;ItemPropValue&gt;&gt; itemPropValueIdItemPropValueWithOutAddItemPropResult = new HashMap&lt;&gt;();</div><div class="line"></div><div class="line">    itemPropValueIdItemPropValueWithOutAddItemProp.entrySet().stream().sorted(Map.Entry.&lt;Long, List&lt;ItemPropValue&gt;&gt;comparingByKey())</div><div class="line">        .forEachOrdered(x -&gt; itemPropValueIdItemPropValueWithOutAddItemPropResult.put(x.getKey(), x.getValue()));</div><div class="line"></div><div class="line">    int position = 0;</div><div class="line">    for (Long id : itemPropValueIdItemPropValueWithOutAddItemPropResult.keySet()) &#123;</div><div class="line">        if (itemPropValue.getItemPropId() &gt; id) &#123;</div><div class="line">            position++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    /**</div><div class="line">     * From YuanXin</div><div class="line">     */</div><div class="line">    List&lt;String&gt; serviceItemNameStrs = new ArrayList&lt;&gt;();</div><div class="line">    serviceItemNameStrs.add(&quot;&quot;);</div><div class="line"></div><div class="line">    itemPropValueIdItemPropValueWithOutAddItemProp.forEach((k, v) -&gt; &#123;</div><div class="line">        int preSize = serviceItemNameStrs.size();</div><div class="line"></div><div class="line">        v.forEach(itemPV -&gt; &#123;</div><div class="line">            for (int i = 0; i &lt; preSize; i++) &#123;</div><div class="line">                serviceItemNameStrs.add(serviceItemNameStrs.get(i) + itemPV.getValue() + &quot;-&quot;);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        for (int i = 0; i &lt; preSize; i++) &#123;</div><div class="line">            serviceItemNameStrs.remove(0);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    /**</div><div class="line">     * Thanks YuanXin</div><div class="line">     */</div><div class="line">    serviceItemContext.setServiceItemNameStrs(serviceItemNameStrs);</div><div class="line">    serviceItemContext.setPropIdPosition(position);</div><div class="line"></div><div class="line">    return serviceItemContext;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这段代码用到了java8的新特性之一–lambda表达式。第一个lambda表达式，将除新增属性值所属属性id之外的所有属性id遍历出来，并将其放入一个List中；第二个lambda表达式根据第一个表达式的List集合获取每个属性下所有属性值，并将每个查询结果映射成一个map集合，key是属性id，value是属性下所有属性值；为避免每次查询的List结果顺序不一致，因此第三个lambda表达式用来对第二个lambda表达式的结果Map集合的value结果集进行排序。到此，已经获取到了有序的除去新增属性之外其他属性的属性值，接下来，就是将这个结果和新增的属性值进行叉乘，生成新的ServiceItem。但是关键的叉乘问题来了，首先并不知道有取出的集合中有几个属性，属性下有几个属性值，所以无法拿到每个属性值进行叉乘。我在做这块的时候，这个问题困扰我整整一个下午，后来找袁鑫同学沟通，他后来想了一个绝妙的算法，完美解决了这个死锁问题，也就是最后9行代码，整个Item系统中最有分量的代码。在这里对袁鑫同学说句感谢！他给出的解是通过在有限的空间里，组装所有不同属性的属性值。具体思路是这样的：</p>
<p><strong>① List<string> serviceItemNameStrs = new ArrayList&lt;&gt;();</string></strong><br>这一步是创建一个有限的空间，用来存储遍历完成的属性值和不同属性值的组装结果；<br><strong>② serviceItemNameStrs.add(“”);</strong><br>这一步是初始化空间大小，用来保存第一次遍历的属性值；<br><strong>③ itemPropValueIdItemPropValueWithOutAddItemProp.forEach((k, v) -&gt; {};</strong><br>这一步是遍历每个属性；<br><strong>④ int preSize = serviceItemNameStrs.size();</strong><br>获取空间大小；<br><strong>⑤ v.forEach(itemPV -&gt; {}</strong><br>遍历每个属性下的所有属性值<br><strong>⑥ for (int i = 0; i &lt; preSize; i++){<br>    serviceItemNameStrs.add(serviceItemNameStrs.get(i) +itemPV.getValue() + “-“);<br>}</strong><br>这一步是将每个属性下的属性值保存到空间中；</p>
<p><strong>⑦ for (int i = 0; i &lt; preSize; i++) {<br>        serviceItemNameStrs.remove(0);<br>    }</strong></p>
<p>这一步是这7步中最精妙的地方，在每次遍历完一组属性之后，完产生上次遍历属性值所产生的中间值，需要将这些值删除掉。<br>现举个例子推演一下整个过程，某个Item已有属性性别，属性值是男和女，属性级别，属性值是普通和高级，新增属性周期，属性值是5天和7天。在叉乘属性值的时候，需要取出男女属性值，普通高级属性值，和新添的属性值组合。<br>第一次运行③时，此时的value是（男，女），④的结果是1，⑤首次遍历的是男，男和“-”进行组合，置于List中，第二次遍历是女，女和“-”进行组合，同样置于List中，此时性别属性遍历完成，List中有三个元素，分别是“”，“男-”，“女-”，而“”是多余，需要删除，因此⑦删除“”；<br>第二次运行③，此时的value是（普通，高级），④的结果是2，⑤首次遍历的是普通，普通和“男-”进行组合，置于List中，第二次遍历是，普通和“女-”进行组合，同样置于List中，此时普通属性值遍历完成，高级属性值组合过程同上，⑥步完成之后，List中有三个元素，分别是“男-”，“女-”，“男-普通”，“女-普通”，“男-高级”，“女-高级”，而“男-”，“女-”是多余的，需要删除，因此⑦删除“男-”，“女-”；<br>…….</p>
<ol>
<li>新增已有属性的属性值。<br>过程同增加新属性新属性值。</li>
</ol>
<h2 id="关于理想程序员"><a href="#关于理想程序员" class="headerlink" title="关于理想程序员"></a>关于理想程序员</h2><p>当面对一个未知的问题时，如何定位复杂条件下的核心问题、如何抽丝剥茧地分析问题的潜在原因、如何排除干扰还原一个最小的可验证场景、如何抓住关键数据验证自己的猜测与实验，是体现程序员思考力的最好场景。然而自己却无法快速定位问题所在，准确无误解决问题，距离一个理想程序员还差得很远。<br>或许，每次我去找晨哥，学文，问他们「遇到一个问题被卡住了，怎么办」的时候，我总觉得自己其实可以做得更好。比如，可以检查试验别的任务，以排除代码自身的原因；可以通过Web UI检查异常；可以排查主机日志缓存，再不济，总应该提供控制台日志给他们，而不应该傻乎乎地跑去问他们，自己一脸懵逼，他们也一头雾水。<br>该来句口号了，不然会觉得少了点什么，<strong>理想的程序员永远不会等事情前进，他们会用尽一切方法让事情前进。</strong><br>与君共勉！</p>

					</div>

			  <!-- about -->
			  
		</div>

		<!-- pagination -->
	  

		<div class="comment-section">
  
  


</div>
	</div>

	

</div>


		<footer>
			

<p>
  由 <a href="https://hexo.io">hexo</a> 强力驱动 | 搭载 <a href="https://github.com/wayou/hexo-theme-material">material</a> 主题
</p>
<p>
  &copy; 2017 <a href="http://yoursite.com"> John Doe </a>
</p>
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	  </div>

		<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		<script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>

		<!-- material design -->
		<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script>
		<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>
		<!-- toc -->
		<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
		<script src="/libs/tocify/jquery.tocify.custom.js"></script>

		<script src="/js/main.js"></script>

	</body>
</html>
