	<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>搜索项目 Big Eye | Hexo</title>
  <meta name="author" content="John Doe">
  
  <meta name="description" content="摘要项目名称Big Eye 大眼睛
当前新建科室非常繁琐，且宣教文章、工具无法方便的共享。为了解决这一问题，决定做一个搜索引擎，做优护家全局索引。
实现以下功能：

当新建科室时，快速从已有知识库中通过标签筛选出与该标签相关联的文章、评估、自评等，迅速、自主的完成「自建科室」；
有其他搜索需求，通过尽可能少的开发量，快速支持新类型的搜索。

需求分析是什么？Big Eye 主要提供一个强大的搜索功能，从已有的知识库中快速检索出文章、评估、自评等等，同时进行相应的排序。
怎么做？搜索主要分为两个阶段。

第一，对已知内容的索引；
MySQL 中的结构化的数据由 ODPS 做数据收集；
并将 ODPS 中的数据做关键属性的索引（倒排索引）；
将索引存入 Redis 中。


第二，查询索引
查询条件 string 输入 Front Door；
将搜索条件从 string 转化为「结构化」的查询数据；
在 Front Door 中将结构化的条件作更进一步的细分，并转发给相应的 Search Engine；
Search Engine 将在 Index 查询的结果返回；
Front Door 调用 Ranker 将数据做排序并返回。">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="搜索项目 Big Eye"/>
  <meta property="og:site_name" content="Hexo"/>

  
  
		<!-- favicon -->
		<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
		<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
		<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
		<link rel="manifest" href="/manifest.json">
		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.png">
		<meta name="theme-color" content="#009688">
		<!-- favicon end -->
    <!-- <link href="/favicon.ico" rel="icon"> -->
  

  <!-- toc -->
  <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css">

  <!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">

  <!-- material design -->
	<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css">
  <!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
	<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  

  

  <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="/libs/jquery-2.0.3.min.js" type="text/javascript"><\/script>')</script>

</head>

 	<body>
	  <nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">菜单</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Hexo</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                    <a href="/" title="">
                    <i class="fa fa-home"></i>首页
                    </a>
                </li>
                
                <li>
                    <a href="/archives" title="">
                    <i class="fa fa-list"></i>存档
                    </a>
                </li>
                
                <li>
                    <a href="/about" title="">
                    <i class="fa fa-info-circle"></i>关于
                    </a>
                </li>
                
                <li>
                    <a href="/atom.xml" title="这是一个订阅源">
                    <i class="fa fa-rss"></i>RSS
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</nav>

	  <div class="container" >
	    <div class="row">
	
	<div class="col-md-9 center-content">
	

		<div class="content">
			<!-- index -->
		   

			  		<h2>搜索项目 Big Eye</h2>
					
					<div>
						<span class="post-time">2017-03-20 16:57:05</span>
					</div>	
					

					<div class="article-content">
						<h2 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h2><p>项目名称<br>Big Eye 大眼睛</p>
<p>当前新建科室非常繁琐，且宣教文章、工具无法方便的共享。为了解决这一问题，决定做一个搜索引擎，做优护家全局索引。</p>
<p>实现以下功能：</p>
<ol>
<li>当新建科室时，快速从已有知识库中通过<strong>标签</strong>筛选出与该标签相关联的文章、评估、自评等，迅速、自主的完成「自建科室」；</li>
<li>有其他搜索需求，通过尽可能少的开发量，快速支持新类型的搜索。</li>
</ol>
<h2 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h2><h3 id="是什么？"><a href="#是什么？" class="headerlink" title="是什么？"></a>是什么？</h3><p>Big Eye 主要提供一个强大的搜索功能，从已有的知识库中快速检索出文章、评估、自评等等，同时进行相应的排序。</p>
<h3 id="怎么做？"><a href="#怎么做？" class="headerlink" title="怎么做？"></a>怎么做？</h3><p>搜索主要分为两个阶段。</p>
<ul>
<li>第一，对已知内容的索引；<ol>
<li>MySQL 中的结构化的数据由 ODPS 做数据收集；</li>
<li>并将 ODPS 中的数据做关键属性的索引（倒排索引）；</li>
<li>将索引存入 Redis 中。</li>
</ol>
</li>
<li>第二，查询索引<ol>
<li>查询条件 <code>string</code> 输入 <code>Front Door</code>；</li>
<li>将搜索条件从 <code>string</code> 转化为「结构化」的查询数据；</li>
<li>在 <code>Front Door</code> 中将结构化的条件作更进一步的细分，并转发给相应的 <code>Search Engine</code>；</li>
<li><code>Search Engine</code> 将在 <code>Index</code> 查询的结果返回；</li>
<li><code>Front Door</code> 调用 <code>Ranker</code> 将数据做排序并返回。</li>
</ol>
</li>
</ul>
<a id="more"></a>
<p><img src="http://static.wayknew.com/assets/2017-03-09/d859edad-c9f5-4d3f-b44a-058b80abf6fc.png" width="800"></p>
<h3 id="文档更新"><a href="#文档更新" class="headerlink" title="文档更新"></a>文档更新</h3><table>
<thead>
<tr>
<th>时间</th>
<th>内容</th>
<th>维护人</th>
</tr>
</thead>
<tbody>
<tr>
<td>2017-3-20</td>
<td>创建文档</td>
<td>田学文</td>
</tr>
<tr>
<td>2017-3-27</td>
<td>更新文档</td>
<td>袁鑫</td>
</tr>
</tbody>
</table>
<h2 id="搜索模块"><a href="#搜索模块" class="headerlink" title="搜索模块"></a>搜索模块</h2><p><img src="/media/searcher.png" alt="搜索流程图"></p>
<p><strong>搜索流程</strong></p>
<p>当 Front Door 将一个 Query String 转化为结构化的查询对象后，其中的原子Query 即为一个 Tag的 TagId。如何通过 TagID 查询到具体的 ArticleList ，需要执行一下流程：</p>
<ol>
<li><p>在 Redis 中根据TagID 查询 <code>get(&#39;T:5&#39;)</code> 得到该 TagID 的Tag树路径<code>&#39;T:1:2:5&#39;</code></p>
</li>
<li><p>通过Redis 获取<code>&#39;T:1:2:5*</code> 的相关所有TagPath 如下：</p>
</li>
</ol>
<ul>
<li>‘T:1:2:5’</li>
<li>‘T:1:2:5:9’</li>
<li>‘T:1:2:5:15’</li>
</ul>
<ol>
<li><p>把一个Tag中所有TagPath，依次在 Redis 中查询 <code>get(&#39;T:1:2:5&#39;)</code> 得到该 TagID 对应TagPath的所有articleIds</p>
</li>
<li><p>对 <code>aids</code> 中的值，即 <code>Article.id</code> 再次请求 <code>get(&#39;A:&lt;articleId&gt;&#39;)</code> 获取到宣教内容。数据格式，即为<code>宣教文章</code>格式。</p>
</li>
<li><p>得到各tagID找出来的结果<code>tagResult</code>，然后通过各tagID的Operation，把<code>tagResult</code> merge成整个Query的<code>SearchResult</code></p>
</li>
</ol>
<h3 id="Ranker"><a href="#Ranker" class="headerlink" title="Ranker"></a>Ranker</h3><p>针对查询的参数，对返回结果进行排序。项目第一期只做简单排序。</p>
<p>排序规则：TODO</p>
<h2 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h2><p><img src="/media/bigeye-dfd.png" alt="数据流图"></p>
<h3 id="搜索条件（Query）"><a href="#搜索条件（Query）" class="headerlink" title="搜索条件（Query）"></a>搜索条件（Query）</h3><p>可以是页面之间请求的 URL，搜索内容以参数的形式嵌入 URL 中。</p>
<blockquote>
<p>POST /api/bigeye/v1/search</p>
</blockquote>
<p><strong>Request</strong><br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"pre"</span>: &#123;</div><div class="line">    <span class="attr">"pre"</span>: <span class="string">"2"</span>,</div><div class="line">    <span class="attr">"op"</span>: <span class="string">"0"</span>,</div><div class="line">    <span class="attr">"post"</span>: <span class="string">"5"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"op"</span>: <span class="string">"1"</span>,</div><div class="line">  <span class="attr">"post"</span>: &#123;</div><div class="line">    <span class="attr">"pre"</span>: <span class="string">"6"</span>,</div><div class="line">    <span class="attr">"op"</span>: <span class="string">"0"</span>,</div><div class="line">    <span class="attr">"post"</span>: <span class="string">"1"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>OP操作符</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">enum Operation &#123;</div><div class="line">  Intersect = 0;</div><div class="line">  Union = 1;</div><div class="line">  Except = 2;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="Redis-索引结构（存储结构）"><a href="#Redis-索引结构（存储结构）" class="headerlink" title="Redis 索引结构（存储结构）"></a>Redis 索引结构（存储结构）</h3><p><strong>1. tagID</strong><br>存储的Key为T开头的Tag树完整路径，以TagID为标识，以“:”为每个TagID间分隔符<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&quot;TID:7&quot;</div><div class="line">    =&gt; &quot;T:1:5:7&quot;</div><div class="line">&quot;TID:15&quot;</div><div class="line">    =&gt; &quot;T:1:5:15&quot;</div></pre></td></tr></table></figure></p>
<p><strong>2. tagPath</strong><br>存储的Key为T开头的Tag树完整路径，以TagID为标识，以“:”为每个TagID间分隔符<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&quot;T:1:5:7:10&quot;</div><div class="line">    =&gt; &#123;&quot;aids&quot;: [1, 2, 3, 4, 5, 6]&#125;</div><div class="line">&quot;T:1:5:15:22&quot;</div><div class="line">    =&gt; &#123;&quot;aids&quot;: [1, 2, 4, 7, 9, 16]&#125;</div></pre></td></tr></table></figure></p>
<p><strong>3. article</strong><br>存储的Key为A+“:”+articleId的结构，与<code>宣教模型</code>一致即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&quot;A:1&quot;</div><div class="line">    =&gt; &#123;&quot;articleId&quot;: 1, &quot;articleName&quot;: &quot;name 1&quot;, &quot;foo&quot;: &quot;bar&quot;&#125;,</div><div class="line">&quot;A:2&quot;</div><div class="line">    =&gt; &#123;&quot;articleId&quot;: 2, &quot;articleName&quot;: &quot;name 2&quot;, &quot;foo&quot;: &quot;bar&quot;&#125;,</div></pre></td></tr></table></figure>
<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><ol>
<li>tagPath,”T:1:2”需要把所有找出如下所有tagPath下的内容</li>
</ol>
<ul>
<li>‘T:1:2’</li>
<li>‘T:1:2:3’</li>
<li>‘T:1:2:4’</li>
<li>‘T:1:2:5’</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 1. Get all tagPath by tagID</span></div><div class="line">redis.keys(<span class="string">"T:1:2*"</span>) = [<span class="string">"T:1:2"</span>,<span class="string">"T:1:2:3"</span>,<span class="string">"T:1:2:4"</span>,<span class="string">"T:1:2:5"</span>]</div></pre></td></tr></table></figure>
<ol>
<li>文章只能关联到 tag 树的叶子节点。<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 1. Get articleIds by tagPath</span></div><div class="line">redis.get(<span class="string">"T:1:2:3"</span>) = &#123;<span class="string">"aids"</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;</div><div class="line"></div><div class="line"><span class="comment"># 2. Get article content via `articleId`</span></div><div class="line">redis.get(<span class="string">"A:1"</span>) = &#123;<span class="string">"articleId"</span>: <span class="number">1</span>, <span class="string">"content"</span>: <span class="string">"xxx"</span>&#125;</div><div class="line">redis.get(<span class="string">"A:2"</span>) = &#123;<span class="string">"articleId"</span>: <span class="number">2</span>, <span class="string">"content"</span>: <span class="string">"xxx"</span>&#125;</div><div class="line">redis.get(<span class="string">"A:3"</span>) = &#123;<span class="string">"articleId"</span>: <span class="number">3</span>, <span class="string">"content"</span>: <span class="string">"xxx"</span>&#125;</div><div class="line"></div><div class="line"><span class="comment"># Ranker</span></div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="结果实体"><a href="#结果实体" class="headerlink" title="结果实体"></a>结果实体</h3><p>搜索模块根据搜索的内容实体 (Entity) 有：</p>
<ul>
<li>宣教文章</li>
</ul>
<p><strong>宣教文章</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"articleId"</span>: <span class="number">1</span>,</div><div class="line">  <span class="attr">"title"</span>: <span class="string">"颅内"</span>,</div><div class="line">  <span class="attr">"article"</span>: [</div><div class="line">    &#123;</div><div class="line">      <span class="attr">"articleId"</span>: <span class="number">1</span>,</div><div class="line">      <span class="attr">"name"</span>: <span class="string">"颅内高压 后期如何恢复？优护家专家专题解说"</span>,</div><div class="line">      <span class="attr">"brief"</span>: <span class="string">"颅内高压康复，如何吃很重要"</span>,</div><div class="line">      <span class="attr">"author"</span>: <span class="string">"优护家刘专家"</span>,</div><div class="line">      <span class="attr">"content"</span>: <span class="string">"&lt;p&gt;请在这里编辑内容，꧁簡҉ ҉單҉ ҉點꧂&lt;/p&gt;"</span>,</div><div class="line">      ...</div><div class="line">    &#125;</div><div class="line">  ]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="类模型"><a href="#类模型" class="headerlink" title="类模型"></a>类模型</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">com.youhujia.bigeye</div><div class="line">  |- search</div><div class="line">    |- SearchBO</div><div class="line">    |- SearchController</div><div class="line">    |- SearchFactory</div><div class="line">  |- searcher</div><div class="line">    |- impl</div><div class="line">      |- ArticleSearcher</div><div class="line">      |- ToolSearcher</div><div class="line">    |- AbstractSearcher</div><div class="line">    |- BaseSearcher</div><div class="line">    |- SearchContext</div><div class="line">    |- SearchEntry</div><div class="line">    |- SearchResult</div><div class="line">    |- SearcherConfig</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">BigEye.Query query = frontDoorBO.parseQuery(queryString);</div><div class="line"></div><div class="line"><span class="comment">// SearchContext.java</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SearchContext</span> </span>&#123;</div><div class="line">  <span class="keyword">private</span> String tagName;</div><div class="line">  <span class="keyword">private</span> String title;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// BaseSearch.java</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">BaseSearch</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">void</span> <span class="title">search</span><span class="params">(searchContext)</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// AbstractSearch.java</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractSearch</span> <span class="title">implement</span> <span class="title">BaseSearch</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">abstract</span> List <span class="title">doSearch</span><span class="params">(SearchContext context)</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// ArticleSearcher.java</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArticleSearcher</span> <span class="title">extend</span> <span class="title">AbstractSearch</span> </span>&#123;</div><div class="line"></div><div class="line">  <span class="meta">@Override</span></div><div class="line">  <span class="keyword">public</span> List&lt;BigEye.Article&gt; doSearch(SearchContext context) &#123;</div><div class="line">    <span class="comment">// Do search in redis</span></div><div class="line">    List&lt;Long&gt; aids = jedis.get(context.getTagName());</div><div class="line">    List&lt;BigEye.Article&gt; articles = aids.stream().map(id-&gt; jedis.get(id));</div><div class="line">    <span class="keyword">return</span> articles;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SearchEntry</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> List&lt;AbstractSearcher&gt; searcherList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SearchResult <span class="title">doSearch</span><span class="params">(SearchContext context)</span> </span>&#123;</div><div class="line">        SearchResult result = <span class="keyword">new</span> SearchResult();</div><div class="line">        searcherList.forEach(searcher -&gt; result.addResult(searcher.doSearch(context), searcher.getClass()));</div><div class="line">        <span class="keyword">return</span> doRanker(result);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> SearchResult <span class="title">doRanker</span><span class="params">(SearchResult searchResult)</span> </span>&#123;</div><div class="line">        List&lt;BigEye.Article&gt; articles = searchResult.getMap().get(ArticleSearcher.class.getName());</div><div class="line">        List&lt;BigEye.Tool&gt; tools = searchResult.getMap().get(ToolSearcher.class.getName());</div><div class="line">        searchResult.setArticles(articles);</div><div class="line">        searchResult.setTools(tools);</div><div class="line">        <span class="keyword">return</span> searchResult;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@PostConstruct</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        searcherConfig.getSearcherNames().forEach(searcherName -&gt; register(getSearcherByString(searcherName)));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(AbstractSearcher searcher)</span> </span>&#123; searcherList.add(searcher); &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SearchResult</span></span>&#123;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResult</span><span class="params">(List list, Class clazz)</span> </span>&#123;map.put(clazz.getName(), list); &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

					</div>

			  <!-- about -->
			  
		</div>

		<!-- pagination -->
	  

		<div class="comment-section">
  
  


</div>
	</div>

	

</div>


		<footer>
			

<p>
  由 <a href="https://hexo.io">hexo</a> 强力驱动 | 搭载 <a href="https://github.com/wayou/hexo-theme-material">material</a> 主题
</p>
<p>
  &copy; 2017 <a href="http://yoursite.com"> John Doe </a>
</p>
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	  </div>

		<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		<script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>

		<!-- material design -->
		<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script>
		<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>
		<!-- toc -->
		<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
		<script src="/libs/tocify/jquery.tocify.custom.js"></script>

		<script src="/js/main.js"></script>

	</body>
</html>
