	<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>自然人模型管理后台设计 | Hexo</title>
  <meta name="author" content="John Doe">
  
  <meta name="description" content="摘要自然人模型后台管理系统详细设计">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="自然人模型管理后台设计"/>
  <meta property="og:site_name" content="Hexo"/>

  
  
		<!-- favicon -->
		<link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-57x57.png">
		<link rel="apple-touch-icon" sizes="60x60" href="/apple-touch-icon-60x60.png">
		<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-72x72.png">
		<link rel="apple-touch-icon" sizes="76x76" href="/apple-touch-icon-76x76.png">
		<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114x114.png">
		<link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
		<link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
		<link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
		<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
		<link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96">
		<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
		<link rel="manifest" href="/manifest.json">
		<meta name="msapplication-TileColor" content="#009688">
		<meta name="msapplication-TileImage" content="/mstile-144x144.png">
		<meta name="theme-color" content="#009688">
		<!-- favicon end -->
    <!-- <link href="/favicon.ico" rel="icon"> -->
  

  <!-- toc -->
  <link rel="stylesheet" href="/libs/tocify/jquery.tocify.css" media="screen" type="text/css">

  <!-- <link rel="stylesheet" href="/libs/bs/css/bootstrap.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap/3.3.4/css/bootstrap.min.css" media="screen" type="text/css">

  <!-- material design -->
	<!-- <link rel="stylesheet" href="/libs/bs-material/css/ripples.min.css" media="screen" type="text/css"> -->
  <link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/ripples.min.css" media="screen" type="text/css">
  <!-- <link rel="stylesheet" href="/libs/bs-material/css/material.min.css" media="screen" type="text/css"> -->
	<link rel="stylesheet" href="//apps.bdimg.com/libs/bootstrap-material/0.3.0/css/material.min.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/highlight.light.css" media="screen" type="text/css">

  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  

  

  <script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="/libs/jquery-2.0.3.min.js" type="text/javascript"><\/script>')</script>

</head>

 	<body>
	  <nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">菜单</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Hexo</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                    <a href="/" title="">
                    <i class="fa fa-home"></i>首页
                    </a>
                </li>
                
                <li>
                    <a href="/archives" title="">
                    <i class="fa fa-list"></i>存档
                    </a>
                </li>
                
                <li>
                    <a href="/about" title="">
                    <i class="fa fa-info-circle"></i>关于
                    </a>
                </li>
                
                <li>
                    <a href="/atom.xml" title="这是一个订阅源">
                    <i class="fa fa-rss"></i>RSS
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</nav>

	  <div class="container" >
	    <div class="row">
	
	<div class="col-md-9 center-content">
	

		<div class="content">
			<!-- index -->
		   

			  		<h2>自然人模型管理后台设计</h2>
					
					<div>
						<span class="post-time">2017-03-25 23:00:00</span>
					</div>	
					

					<div class="article-content">
						<h1 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h1><p>自然人模型后台管理系统详细设计</p>
<a id="more"></a>
<h2 id="WIKI维护人"><a href="#WIKI维护人" class="headerlink" title="WIKI维护人"></a>WIKI维护人</h2><p>黄英</p>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>什么是自然人，百度上给出的解释是：自然人（natural person） 是在自然状态下出生的人。是不是感觉说了和没说没区别。那我们这个这次项目所需要设计的自然人模型又是什么呢？首先说一下我们这个自然人是针对优护家的患者，而自然人模型则是自然人的我们所需的病人所有信息数据的集合，是基于数据战略沉淀的一套用来多角度描述患者的数据模型。设计用户的内容也不只是简单的姓名、性别等这些基本信息，而是包括病人的身体健康情况、疾病历史、出入院信息以及科研信息等这些由患者身体将康以及所衍生出来的信息。</p>
<h2 id="自然人模型"><a href="#自然人模型" class="headerlink" title="自然人模型"></a>自然人模型</h2><p>自然人模型个人理解即为自然人信息数据模型，而自然人的数据模型可以将其看成一个信息树，一个患者可以看成是一棵树，而他的信息可以看成是树叶，一片树叶是一个人的某个特定的信息，每个人的信息具体数值可能都有不同，但是叶子的信息指的是什么这是一定的。例如，这片叶子代表的是身高，那么每个人的这片叶子都是身高，但是身高是多少，则根据每个人的具体值而定。而这个每一片叶子代表什么也需要我们去定义，具体如何定义的参见如下</p>
<p>结构定义如下图</p>
<p><img src="/media/自然人结构图.png" alt=""></p>
<p>而这些标准都是需要存入数据中，具体存入结构如何，参见下面<strong>数据库设计df_metadata表</strong></p>
<h2 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h2><p>由上面的描述我们知道了自然人的数据的节点的定义需要落地到数据库中，这些定义数据则是为元数据，那么存储数据的表则叫元数据表</p>
<h3 id="元数据表：df-metadata"><a href="#元数据表：df-metadata" class="headerlink" title="元数据表：df_metadata"></a>元数据表：df_metadata</h3><table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>唯一标志</td>
</tr>
<tr>
<td>code</td>
<td>string</td>
<td>优护家唯一编码</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td>元数据名称</td>
</tr>
<tr>
<td>description</td>
<td>string</td>
<td>元数据描述</td>
</tr>
<tr>
<td>data_type</td>
<td>long</td>
<td>数据项数据类型:枚举值，具体代表含义 1. string 2. int 3. float 4. bool 5. unary 6. date</td>
</tr>
<tr>
<td>expiration</td>
<td>long</td>
<td>数据项数据失效时间，是一个相对时间，相对于df_data_item.generated_at</td>
</tr>
</tbody>
</table>
<p>（数据真实产生时间），单位，毫秒 |<br>| standard_display_format | string | 数据项数据标准显示格式  |<br>| standard_unit | string | 数据项数据标准单位（如kg、g等） |<br>| standard_mapping |string | 元数据和其他国际标准对应的编码 json 格式 例如： {“icd-10”:”A03-1”} |<br>| created_at | date | 创建时间 |<br>| updated_at | date | 修改时间 |</p>
<h3 id="建表语句"><a href="#建表语句" class="headerlink" title="建表语句"></a>建表语句</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE `df_metadata`(</div><div class="line">  `id` BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT &apos;元数据主键&apos;,</div><div class="line">  `code` VARCHAR(255) NOT NULL unique COMMENT &apos;优护家元数据唯一编码&apos;,</div><div class="line">  `name` VARCHAR(512) COMMENT &apos;元数据名称&apos;,</div><div class="line">  `description` TEXT COMMENT &apos;元数据描述&apos;,</div><div class="line">  `data_type` BIGINT(20) COMMENT &apos;数据项数据类型&apos;,</div><div class="line">  `expiration` BIGINT(20) COMMENT &apos;数据项数据失效时间，是一个相对时间，相对于df_data_item.generated_at</div><div class="line">（数据真实产生时间），单位，毫秒&apos;,</div><div class="line">  `standard_display_format` VARCHAR(255) COMMENT &apos;数据项数据标准显示格式&apos;,</div><div class="line">  `standard_unit` VARCHAR(255) COMMENT &apos;数据项数据标准单位（如kg、g等）&apos;,</div><div class="line">  `standard_mapping` VARCHAR(512) COMMENT &apos;元数据和其他国际标准对应的编码 json 格式 例如： &#123;&quot;icd-10&quot;:&quot;A03-1&quot;&#125;&apos;,</div><div class="line">  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &apos;创建时间&apos;,</div><div class="line">  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &apos;更新时间&apos;,</div><div class="line">  PRIMARY KEY (`id`),</div><div class="line">  KEY `df_code_index` (`code`),</div><div class="line">  KEY `df_name_index` (`name`)</div><div class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</div></pre></td></tr></table></figure>
<h3 id="元数据数据落地："><a href="#元数据数据落地：" class="headerlink" title="元数据数据落地："></a>元数据数据落地：</h3><ol>
<li><p>优护家元数据唯一code编码确定：<br>一级：YHJ、<br>二级：YHJ.AA——YHJ.ZZ、<br>三级：YHJ.AA.001——YHJ.ZZ.999、<br>四级：YHJ.AA.001.001——YHJ.ZZ.999.999、<br>…..<br>十级：YHJ.AA.001.001.001.001.001.001.001.001——YHJ.ZZ.999.999.999.999.999.999.999.999</p>
</li>
<li><p>需要整理自然人的所有数据，以及入库。</p>
</li>
</ol>
<p>数据库数据示例：</p>
<p><img src="/media/元数据数据库实例数据.png" alt=""></p>
<h3 id="自然人数据项：-df-data-item"><a href="#自然人数据项：-df-data-item" class="headerlink" title="自然人数据项： df_data_item"></a>自然人数据项： df_data_item</h3><p>自然人的数据：由自然人的唯一标志符和数据项的集合组成，唯一标志符即下面的user_id，一个user_id会对应多条数据项</p>
<table>
<thead>
<tr>
<th>字段</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>long</td>
<td>该条数据的唯一标志</td>
</tr>
<tr>
<td>user_id</td>
<td>long</td>
<td>自然人的id</td>
</tr>
<tr>
<td>df_metadata_code</td>
<td>string</td>
<td>元数据编码</td>
</tr>
<tr>
<td>value</td>
<td>string</td>
<td>具体的值，应该是经过序列化的</td>
</tr>
<tr>
<td>is_valid</td>
<td>bit</td>
<td>默认为1，为有效</td>
</tr>
<tr>
<td>provider</td>
<td>long</td>
<td>数据收集方</td>
</tr>
<tr>
<td>collecting_method</td>
<td>long</td>
<td>数据收集方法</td>
</tr>
<tr>
<td>collector</td>
<td>long</td>
<td>数据收集器</td>
</tr>
<tr>
<td>generated_at</td>
<td>timeStamp</td>
<td>数据真实产生的时间</td>
</tr>
<tr>
<td>collected_at</td>
<td>timeStamp</td>
<td>收集器收集数据时间</td>
</tr>
<tr>
<td>created_at</td>
<td>timeStamp</td>
<td>入库时间</td>
</tr>
<tr>
<td>updated_at</td>
<td>timeStamp</td>
<td>修改时间</td>
</tr>
</tbody>
</table>
<h4 id="建表语句-1"><a href="#建表语句-1" class="headerlink" title="建表语句"></a>建表语句</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE `df_data_item`(</div><div class="line">  `id` BIGINT(20) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT &apos;数据项主键&apos;,</div><div class="line">  `user_id` BIGINT(20) UNSIGNED NOT NULL COMMENT &apos;数据项主键&apos;,</div><div class="line">  `df_metadata_code` VARCHAR(255) NOT NULL COMMENT &apos;元数据编码&apos;,</div><div class="line">  `value` TEXT COMMENT &apos;具体的值，可能是经过序列化的&apos;,</div><div class="line">  `is_valid` BIT DEFAULT 1 COMMENT &apos;默认为1，有效&apos;,</div><div class="line">  `provider` BIGINT(20) NOT NULL COMMENT &apos;数据收集方&apos;,</div><div class="line">  `collecting_method` BIGINT(20)  NOT NULL COMMENT &apos;数据收集方法&apos;,</div><div class="line">  `collector` BIGINT(20) NOT NULL COMMENT &apos;数据收集器&apos;,</div><div class="line">  `generated_at` TIMESTAMP  DEFAULT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &apos;数据真实产生时间&apos;,</div><div class="line">  `collected_at` TIMESTAMP DEFAULT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &apos;收集器时间&apos;,</div><div class="line">  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &apos;创建时间&apos;,</div><div class="line">  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &apos;更新时间&apos;,</div><div class="line">  PRIMARY KEY (`id`),</div><div class="line">  KEY `df_data_item_df_metadata_code_index` (`df_metadata_code`),</div><div class="line">  KEY `df_data_item_provider_index` (`provider`),</div><div class="line">  KEY `df_data_item_collecting_method_index` (`collecting_method`),</div><div class="line">  KEY `df_data_item_collector_index` (`collector`) </div><div class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8;</div></pre></td></tr></table></figure>
<h4 id="字段补充说明："><a href="#字段补充说明：" class="headerlink" title="字段补充说明："></a>字段补充说明：</h4><p><strong>provider:</strong></p>
<p>数据的提供方，现在已知的枚举如下，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public enum ProviderEnum &#123;</div><div class="line">    OTHER(1,&quot;其他&quot;),</div><div class="line">    YHJ(2,&quot;优护家&quot;),</div><div class="line">    WN(3,&quot;卫宁&quot;);</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<p><strong>collecting_method:</strong></p>
<p>数据的收集方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public enum CollectingMethodEnum &#123;</div><div class="line">    OTHER(1, &quot;其他&quot;),</div><div class="line">    SYSTEM(2, &quot;系统录入&quot;),</div><div class="line">    EVALUATION(3,&quot;评估&quot;),</div><div class="line">    SELF_ASSESSMENT(4,&quot;自测&quot;),</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>collector:</strong></p>
<p>数据的收集器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">public enum CollectorEnum &#123;</div><div class="line">    OTHER(1,&quot;其他&quot;),</div><div class="line">    YHJ_C_TERMINAL(2,&quot;优护C端&quot;),</div><div class="line">    YHJ_APP(3,&quot;优护助手&quot;),</div><div class="line">    ML_BRACELET(4,&quot;小米手环&quot;),</div><div class="line">    BLOOD_PRESSURE_MONITOR(5,&quot;血压计&quot;);</div><div class="line">    </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="接口设计"><a href="#接口设计" class="headerlink" title="接口设计"></a>接口设计</h3><p>作为service层，主要是提供CRUD操作，由于元数据基本是直接写入数据库中，而且一旦确定，基本变动久很小，所以只有提供查询接口。而针对于数据项来说，一旦数据落入库中，现定的是就不会更改删除，所以也只提供增加查询接口。</p>
<h4 id="创建单个数据项"><a href="#创建单个数据项" class="headerlink" title="创建单个数据项"></a>创建单个数据项</h4><blockquote>
<p>POST /api/human/v1/data-items/create-data-item</p>
</blockquote>
<p><strong>request:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">&quot;userId&quot;: 1,</div><div class="line">&quot;dfMetadataCode&quot;: &quot;YHJAA.001.001&quot;,</div><div class="line">&quot;dfDataItemValue&quot;: &quot;路过&quot;,</div><div class="line">&quot;provider&quot;: 1,</div><div class="line">&quot;collecting_method&quot;: 1,</div><div class="line">&quot;collector&quot;: 1,</div><div class="line">&quot;generatedAt&quot;: &quot;1491041660000&quot;,</div><div class="line">&quot;collectedAt&quot;: &quot;1491041660000&quot; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>response:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">&quot;result&quot;:&#123;</div><div class="line">    &quot;code&quot;: 0,</div><div class="line">    &quot;success&quot;: true</div><div class="line">    &#125;</div><div class="line">&quot;dataItemId&quot;: 1,</div><div class="line">&quot;userId&quot;: 10086,</div><div class="line">&quot;metadataCode&quot;: &quot;YHJAA.001.001&quot;,</div><div class="line">&quot;value&quot;: &quot;路过&quot;,</div><div class="line">&quot;provider&quot;: 1,</div><div class="line">&quot;collecting_method&quot;: 1,</div><div class="line">&quot;collector&quot;: 1,</div><div class="line">&quot;generatedAt&quot;: &quot;1491041660000&quot;,</div><div class="line">&quot;collectedAt&quot;: &quot;1491041660000&quot; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="创建多个数据项"><a href="#创建多个数据项" class="headerlink" title="创建多个数据项"></a>创建多个数据项</h4><blockquote>
<p>POST /api/human/v1/data-items/create-data-items</p>
</blockquote>
<p><strong>request:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;CreateDataItemOptionList&quot;: [</div><div class="line">        &#123;</div><div class="line">            &quot;userId&quot;: 1,</div><div class="line">            &quot;dfMetadataCode&quot;: &quot;YHJAA.001.001&quot;,</div><div class="line">            &quot;dfDataItemValue&quot;: &quot;路过&quot;,</div><div class="line">            &quot;provider&quot;: 1,</div><div class="line">            &quot;collecting_method&quot;: 1,</div><div class="line">            &quot;collector&quot;: 1,</div><div class="line">            &quot;generatedAt&quot;: &quot;1491041660000&quot;,</div><div class="line">            &quot;collectedAt&quot;: &quot;1491041660000&quot;</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>response:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;result&quot;: &#123;</div><div class="line">        &quot;code&quot;: 0,</div><div class="line">        &quot;success&quot;: true</div><div class="line">    &#125;,</div><div class="line">    &quot;dataItemDTO&quot;: [</div><div class="line">        &#123;</div><div class="line">            &quot;dataItemId&quot;: 1,</div><div class="line">            &quot;userId&quot;: 10086,</div><div class="line">            &quot;metadataCode&quot;: &quot;YHJAA.001.001&quot;,</div><div class="line">            &quot;value&quot;: &quot;路过&quot;,</div><div class="line">            &quot;provider&quot;: 1,</div><div class="line">            &quot;collecting_method&quot;: 1,</div><div class="line">            &quot;collector&quot;: 1,</div><div class="line">            &quot;generatedAt&quot;: &quot;1491041660000&quot;,</div><div class="line">            &quot;collectedAt&quot;: &quot;1491041660000&quot;</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="创建单个自然人数据项集聚合接口"><a href="#创建单个自然人数据项集聚合接口" class="headerlink" title="创建单个自然人数据项集聚合接口"></a>创建单个自然人数据项集聚合接口</h4><blockquote>
<p>POST /api/human/v1/data-items/create-user-data-items</p>
</blockquote>
<p>每一次数据的沉淀，都会存入多个数据项的值，例如有姓名、性别、年龄等一些项，将姓名姓名、性别、年龄等在df_metadata表中的对应的code值填充入参的dfMetadataCode字段，姓名、性别、年龄等对应的值填充到dfDataItemValue字段</p>
<p><strong>request:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;metadataCodeValuePair&quot;: [</div><div class="line">        &#123;</div><div class="line">            &quot;dfMetadataCode&quot;: &quot;YHJAA.001.001&quot;,</div><div class="line">            &quot;dfDataItemValue&quot;: &quot;路过&quot;</div><div class="line">        &#125;</div><div class="line">    ],</div><div class="line">    &quot;userId&quot;: 1,</div><div class="line">    &quot;provider&quot;: 1,</div><div class="line">    &quot;collecting_method&quot;: 1,</div><div class="line">    &quot;collector&quot;: 1,</div><div class="line">    &quot;generatedAt&quot;: &quot;1491041660000&quot;,</div><div class="line">    &quot;collectedAt&quot;: &quot;1491041660000&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>response:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;result&quot;: &#123;</div><div class="line">        &quot;code&quot;: 0,</div><div class="line">        &quot;success&quot;: true</div><div class="line">    &#125;,</div><div class="line">    &quot;dataItemDTO&quot;: [</div><div class="line">        &#123;</div><div class="line">            &quot;dataItemId&quot;: 1,</div><div class="line">            &quot;userId&quot;: 10086,</div><div class="line">            &quot;metadataCode&quot;: &quot;YHJAA.001.001&quot;,</div><div class="line">            &quot;value&quot;: &quot;路过&quot;,</div><div class="line">            &quot;provider&quot;: 1,</div><div class="line">            &quot;collecting_method&quot;: 1,</div><div class="line">            &quot;collector&quot;: 1,</div><div class="line">            &quot;generatedAt&quot;: &quot;1491041660000&quot;,</div><div class="line">            &quot;collectedAt&quot;: &quot;1491041660000&quot;</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="通过id查询"><a href="#通过id查询" class="headerlink" title="通过id查询"></a>通过id查询</h4><blockquote>
<p>GET /api/human/v1/data-items/{id}</p>
</blockquote>
<p><strong>response：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;result&quot;: &#123;</div><div class="line">        &quot;code&quot;: 0,</div><div class="line">        &quot;success&quot;: true</div><div class="line">    &#125;,</div><div class="line">    &quot;dataItemDTO&quot;: &#123;</div><div class="line">        &quot;dataItemId&quot;: 1,</div><div class="line">        &quot;userId&quot;: 10086,</div><div class="line">        &quot;metadataCode&quot;: &quot;YHJAA.001.001&quot;,</div><div class="line">        &quot;value&quot;: &quot;路过&quot;,</div><div class="line">        &quot;provider&quot;: 1,</div><div class="line">        &quot;collecting_method&quot;: 1,</div><div class="line">        &quot;collector&quot;: 1,</div><div class="line">        &quot;generatedAt&quot;: &quot;1491041660000&quot;,</div><div class="line">        &quot;collectedAt&quot;: &quot;1491041660000&quot;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="组合查询"><a href="#组合查询" class="headerlink" title="组合查询"></a>组合查询</h4><blockquote>
<p>GET /api/human/v1/data-items/query</p>
</blockquote>
<p><strong>request：</strong></p>
<p>备注：query查询参数支持：metadataIds、metadataCodes、user_id、provider、collecting_method、collector,参数任意组合。<br>    metadataIds：即为将一系列的dfMetadata表的id通过逗号拼装为一个新的string</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public enum DataItemQueryEnum &#123;</div><div class="line">    metadataID(&quot;metadataId&quot;, &quot;选添项，元数据的id，多个imetadataIdd可以通过逗号隔开例如 1,2,3&quot;),</div><div class="line">    USER_ID(&quot;userId&quot;, &quot;选添项,用户的id&quot;),</div><div class="line">    PROVIDER(&quot;provider&quot;, &quot;选添项，数据的提供方,参见com.youhujia.halo.nightwatch.provider&quot;),</div><div class="line">    COLLECTING_METHOD(&quot;collectingMethod&quot;, &quot;选添项，数据的收集方法参见com.youhujia.halo.nightwatch.collectingMethod&quot;),</div><div class="line">    COLLECTOR(&quot;collector&quot;, &quot;选添项，数据的收集器，参见com.youhujia.halo.nightwatch.collectorEnum&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>response：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;result&quot;: &#123;</div><div class="line">        &quot;code&quot;: 0,</div><div class="line">        &quot;success&quot;: true</div><div class="line">    &#125;,</div><div class="line">    &quot;dataItemDTO&quot;: [</div><div class="line">        &#123;</div><div class="line">            &quot;dataItemId&quot;: 1,</div><div class="line">            &quot;userId&quot;: 10086,</div><div class="line">            &quot;metadataCode&quot;: &quot;YHJAA.001.001&quot;,</div><div class="line">            &quot;value&quot;: &quot;路过&quot;,</div><div class="line">            &quot;provider&quot;: 1,</div><div class="line">            &quot;collecting_method&quot;: 1,</div><div class="line">            &quot;collector&quot;: 1,</div><div class="line">            &quot;generatedAt&quot;: &quot;1491041660000&quot;,</div><div class="line">            &quot;collectedAt&quot;: &quot;1491041660000&quot;</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="通过ids获取元数据"><a href="#通过ids获取元数据" class="headerlink" title="通过ids获取元数据"></a>通过ids获取元数据</h4><blockquote>
<p>GET /api/human/v1/metadata/{id}</p>
</blockquote>
<p><strong>request:</strong></p>
<p>可以是单个id，也可以是多个id通过逗号隔开，</p>
<p><strong>response：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;result&quot;: &#123;</div><div class="line">        &quot;code&quot;: 0,</div><div class="line">        &quot;success&quot;: true</div><div class="line">    &#125;,</div><div class="line">    &quot;metadataDTO&quot;: [</div><div class="line">        &#123;</div><div class="line">            &quot;metadataId&quot;: 1,</div><div class="line">            &quot;code&quot;: &quot;YHJAA.001.001&quot;,</div><div class="line">            &quot;name&quot;: &quot;姓名&quot;,</div><div class="line">            &quot;description&quot;: &quot;个体在公安管理部门正式登记注册的姓氏和名称&quot;,</div><div class="line">            &quot;dataType&quot;: 1,</div><div class="line">            &quot;expiration&quot;: &quot;180000&quot;,</div><div class="line">            &quot;standardDisplayFormat&quot;: &quot;&quot;</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="通过codes-获取元数据"><a href="#通过codes-获取元数据" class="headerlink" title="通过codes 获取元数据"></a>通过codes 获取元数据</h4><blockquote>
<p>GET /api/human/v1/metadata/{codes}</p>
</blockquote>
<p><strong>request:</strong></p>
<p>可以是单个code，也可以是多个code通过逗号隔开，</p>
<p><strong>response：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;result&quot;: &#123;</div><div class="line">        &quot;code&quot;: 0,</div><div class="line">        &quot;success&quot;: true</div><div class="line">    &#125;,</div><div class="line">    &quot;metadataDTO&quot;: [</div><div class="line">        &#123;</div><div class="line">            &quot;metadataId&quot;: 1,</div><div class="line">            &quot;code&quot;: &quot;YHJAA.001.001&quot;,</div><div class="line">            &quot;name&quot;: &quot;姓名&quot;,</div><div class="line">            &quot;description&quot;: &quot;个体在公安管理部门正式登记注册的姓氏和名称&quot;,</div><div class="line">            &quot;dataType&quot;: 1,</div><div class="line">            &quot;expiration&quot;: &quot;180000&quot;,</div><div class="line">            &quot;standardDisplayFormat&quot;: &quot;&quot;</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="通过元数据name获取元数据"><a href="#通过元数据name获取元数据" class="headerlink" title="通过元数据name获取元数据"></a>通过元数据name获取元数据</h4><blockquote>
<p>GET /api/human/v1/metadata/name/{name}</p>
</blockquote>
<p><strong>response：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;result&quot;: &#123;</div><div class="line">        &quot;code&quot;: 0,</div><div class="line">        &quot;success&quot;: true</div><div class="line">    &#125;,</div><div class="line">    &quot;metadataId&quot;: 1,</div><div class="line">    &quot;code&quot;: &quot;YHJAA.001.001&quot;,</div><div class="line">    &quot;name&quot;: &quot;姓名&quot;,</div><div class="line">    &quot;description&quot;: &quot;个体在公安管理部门正式登记注册的姓氏和名称&quot;,</div><div class="line">    &quot;dataType&quot;: 1,</div><div class="line">    &quot;expiration&quot;: &quot;180000&quot;,</div><div class="line">    &quot;standardDisplayFormat&quot;: &quot;&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="结构代码"><a href="#结构代码" class="headerlink" title="结构代码"></a>结构代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">com.youhujia.human</div><div class="line">    domain</div><div class="line">        dataItem</div><div class="line">            DataItemController</div><div class="line">                |=&gt; public DataItemDTO createDataItem(CreateDataItemOption body);</div><div class="line">                |=&gt; public DataItemDTOList createDataItemList(CreateDataItemOptionList body);</div><div class="line">                |=&gt; public DataItemDTOList createUserDataItems(CreateUserDataItemOption body);</div><div class="line">                |=&gt; public DataItemDTO getDataItemById(Long id);</div><div class="line">                |=&gt; public DataItemList query(Map&lt;String, String&gt; queryMap);</div><div class="line">            DataItemBO</div><div class="line">                public DataItemDTO createDataItem(CreateDataItemOption body);</div><div class="line">                public DataItemDTOList createDataItemList(CreateDataItemOptionList body);</div><div class="line">                public DataItemDTOList createUserDataItems(CreateUserDataItemOption body);</div><div class="line">                public DataItemDTO getDataItemById(Long id);</div><div class="line">                public DataItemList query(Map&lt;String, String&gt; queryMap);</div><div class="line">            DataItem</div><div class="line">            DataItemDao</div><div class="line">            create</div><div class="line">                CreateBO</div><div class="line">                CreateContext</div><div class="line">                CreateContextFactory</div><div class="line">            query</div><div class="line">                QueryBO</div><div class="line">                QueryContext</div><div class="line">                QueryContextFactory</div><div class="line">        metadata</div><div class="line">            MetadataController</div><div class="line">                |=&gt; public metadataDTO getMetadataById(Long id);</div><div class="line">                |=&gt; public metadataDTO getMetadataByCode(string code);</div><div class="line">                |=&gt; public metadataDTO getMetadataByName(string name);</div><div class="line">            Metadata</div><div class="line">            MetadataBO</div><div class="line">                public metadataDTO getMetadataById(Long id);</div><div class="line">                public metadataDTO getMetadataByCode(string code);</div><div class="line">                public metadataDTO getMetadataByName(string name);</div><div class="line">            MetadataDao</div><div class="line">            query</div><div class="line">                QueryBO</div><div class="line">                QueryContext</div><div class="line">                QueryContextFactory</div></pre></td></tr></table></figure>
<h4 id="proto"><a href="#proto" class="headerlink" title="proto"></a>proto</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">message DataItemDTO &#123;</div><div class="line">    optional Result result = 1;</div><div class="line"></div><div class="line">    optional int64 dataItemId = 2;</div><div class="line">    optional int64 userId = 3;</div><div class="line">    optional string metadataCode = 4;</div><div class="line">    optional string value = 5;</div><div class="line">    optional int64 provider = 6;</div><div class="line">    optional int64 collecting_method = 7;</div><div class="line">    optional int64 collector = 8;</div><div class="line">    optional int64 generatedAt = 9;</div><div class="line">    optional int64 collectedAt = 10;</div><div class="line">&#125;</div><div class="line"></div><div class="line">message DataItemDTOList &#123;</div><div class="line">    optional Result result = 1;</div><div class="line">    repeated DataItemDTO dataItem = 2;</div><div class="line">&#125;</div><div class="line"></div><div class="line">message CreateDataItemOption &#123;</div><div class="line">    optional int64 userId = 1;</div><div class="line">    optional string dfMetadataCode = 2;</div><div class="line">    optional string dfDataItemValue = 3;</div><div class="line">    optional int64 provider = 4;</div><div class="line">    optional int64 collecting_method = 5;</div><div class="line">    optional int64 collector = 6;</div><div class="line">    optional int64 generatedAt = 7;</div><div class="line">    optional int64 collectedAt = 8;</div><div class="line">&#125;</div><div class="line"></div><div class="line">message CreateDataItemOptionList &#123;</div><div class="line">    repeated CreateDataItemOption createDataItem = 1;</div><div class="line">&#125;</div><div class="line"></div><div class="line">message CreateUserDataItemOption &#123;</div><div class="line">    repeated MetadataCodeValuePair pair = 1;</div><div class="line">    optional int64 userId = 2;</div><div class="line">    optional int64 provider = 3;</div><div class="line">    optional int64 collecting_method = 4;</div><div class="line">    optional int64 collector = 5;</div><div class="line">    optional int64 generatedAt = 6;</div><div class="line">    optional int64 collectedAt = 7;</div><div class="line">&#125;</div><div class="line"></div><div class="line">message MetadataCodeValuePair &#123;</div><div class="line">    optional string dfMetadataCode = 1;</div><div class="line">    optional string dfDataItemValue = 2;</div><div class="line">&#125;</div><div class="line"></div><div class="line">message MetadataDTO &#123;</div><div class="line">    optional Result result = 1;</div><div class="line">    optional int64 metadataId = 2;</div><div class="line">    optional string code = 3;</div><div class="line">    optional string name = 4;</div><div class="line">    optional string description = 5;</div><div class="line">    optional int64 dataType = 6;</div><div class="line">    optional string expiration = 7;</div><div class="line">    optional string standardDisplayFormat = 8;</div><div class="line">&#125;</div><div class="line"></div><div class="line">message MetadataDTOList&#123;</div><div class="line">    optional Result result = 1;</div><div class="line">    repeated MetadataDTO metadataDTO = 2;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

					</div>

			  <!-- about -->
			  
		</div>

		<!-- pagination -->
	  

		<div class="comment-section">
  
  


</div>
	</div>

	

</div>


		<footer>
			

<p>
  由 <a href="https://hexo.io">hexo</a> 强力驱动 | 搭载 <a href="https://github.com/wayou/hexo-theme-material">material</a> 主题
</p>
<p>
  &copy; 2017 <a href="http://yoursite.com"> John Doe </a>
</p>
<a id="gotop" href="#" title="back to top"><i class="mdi-hardware-keyboard-arrow-up"></i></a>

		</footer>
	  </div>

		<!-- <script src="/libs/bs/js/bootstrap.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		<script>(typeof $().modal == 'function')|| document.write('<script src="/libs/bs/js/bootstrap.min.js" type="text/javascript"><\/script>')</script>

		<!-- material design -->
		<!-- <script src="/libs/bs-material/js/ripples.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/ripples.min.js"></script>
		<!-- <script src="/libs/bs-material/js/material.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/bootstrap-material/0.3.0/js/material.min.js"></script>
		<!-- toc -->
		<!-- <script src="/libs/tocify/jquery-ui.min.js"></script> -->
		<script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
		<script src="/libs/tocify/jquery.tocify.custom.js"></script>

		<script src="/js/main.js"></script>

	</body>
</html>
